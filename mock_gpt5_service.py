#!/usr/bin/env python3
"""
🧪 Mock GPT-5 Service for Testing
Заглушка для тестирования функций без реального API
"""

import asyncio
import json
import logging
import random
import time
from typing import Dict, Any, Optional

logger = logging.getLogger(__name__)

class MockGPT5Service:
    """Mock версия GPT-5 сервиса для тестирования"""

    def __init__(self, preferred_model_id: Optional[str] = None):
        self.default_model_id = preferred_model_id or "gpt-5-mock"
        self.routing = {
            "qa": "gpt-5-mock",
            "code": "gpt-5-mock",
            "chat": "gpt-5-mini-mock",
            "bulk": "gpt-5-nano-mock",
            "analysis": "gpt-5-mock",
            "sentiment": "gpt-5-mini-mock",
            "insights": "gpt-5-mock"
        }
        logger.info("✅ Mock GPT-5 service initialized")

    def choose_model(self, task: str) -> str:
        return self.routing.get(task, self.default_model_id)

    def _generate_mock_analysis(self, prompt: str) -> str:
        """Генерация mock анализа"""
        return f"""# 🧠 ГЛУБОКИЙ АНАЛИЗ ДАННЫХ

## 📊 КЛЮЧЕВЫЕ ТРЕНДЫ И ПАТТЕРНЫ

### 1. Основные тенденции:
- **Рост технологических инноваций** - увеличение на 40% за последний квартал
- **Цифровая трансформация** - ускорение внедрения ИИ решений
- **Инвестиционная активность** - $127 млрд в зеленые технологии

### 2. Статистические показатели:
```
📈 Рост рынка: +25%
💰 Инвестиции: $500B
🏢 Компании: 1,250+ активных участников
🌍 География: 45+ стран
```

## 📈 СТАТИСТИЧЕСКИЕ ИНСАЙТЫ

| Метрика | Значение | Изменение |
|---------|----------|-----------|
| Капитализация | $500B | +25% |
| Активность | 85% | +12% |
| Инновации | 40+ | +30% |

## 🔮 ПРОГНОСТИЧЕСКАЯ АНАЛИТИКА

### Краткосрочные прогнозы (1-3 месяца):
- Стабилизация волатильности
- Рост институциональных инвестиций
- Усиление регулирования

### Долгосрочные тренды (6-12 месяцев):
- Массовое внедрение ИИ технологий
- Развитие квантовых вычислений
- Экологическая трансформация

## 💡 СТРАТЕГИЧЕСКИЕ РЕКОМЕНДАЦИИ

1. **Инвестиционная стратегия**
   - Диверсификация портфеля
   - Фокус на технологические активы
   - Мониторинг регулятивных изменений

2. **Операционные выводы**
   - Автоматизация процессов
   - Развитие цифровых компетенций
   - Устойчивое развитие

3. **Риск-менеджмент**
   - Хеджирование волатильности
   - Стресс-тестирование
   - Резервное планирование

## 📋 ЗАКЛЮЧЕНИЕ

Анализ показывает устойчивый рост технологического сектора с высоким потенциалом для долгосрочных инвестиций. Ключевые факторы успеха - адаптивность, инновации и устойчивое развитие.

*Уровень достоверности: 87%*
*Время анализа: {time.strftime('%Y-%m-%d %H:%M:%S')}*"""

    def _generate_mock_summary(self, prompt: str, length: str = "medium") -> str:
        """Генерация mock сводки"""
        summaries = {
            "short": f"""**📋 КРАТКАЯ СВОДКА**

🔸 **Основные события:** Технологический сектор демонстрирует рост на 25%
🔸 **Ключевые цифры:** $500B капитализация, 40+ инноваций
🔸 **Прогноз:** Положительные тенденции сохранятся

*Генерация: {time.strftime('%H:%M:%S')}*""",

            "medium": f"""**📋 СВОДКА СРЕДНЕЙ ДЛИНЫ**

## 🎯 Executive Summary
- Технологический рынок показывает устойчивый рост (+25%)
- Инвестиции в зеленые технологии достигли $127B
- ИИ технологии становятся ключевым драйвером развития

## 📊 Основные события
1. **Прорыв в ИИ:** GPT-5 улучшил точность анализа на 40%
2. **Криптовалюты:** Стабилизация в диапазоне $45-50K
3. **Зеленая энергетика:** Рекордные показатели эффективности

## 📈 Аналитика
- Институциональные инвесторы проявляют растущий интерес
- Правительства активно поддерживают инновации
- Потребители готовы к цифровой трансформации

## 🔮 Заключение
Сектор готов к дальнейшему росту при условии стабильного регулирования.

*Анализ от {time.strftime('%Y-%m-%d %H:%M:%S')}*""",

            "long": f"""**📋 ДЕТАЛЬНАЯ СВОДКА**

## 🎯 Executive Summary
Комплексный анализ технологического сектора показывает устойчивую тенденцию роста с ключевыми драйверами в виде искусственного интеллекта, квантовых вычислений и зеленых технологий.

## 📊 Детальные события

### 🤖 Искусственный интеллект
- **GPT-5 и аналоги:** Улучшение точности на 40%
- **Автоматизация:** Революционные изменения в бизнес-процессах
- **Инвестиции:** Рост на 65% за год

### 💰 Финансовые рынки
- **Криптовалюты:** Bitcoin стабилизировался $45-50K
- **Институциональные инвестиции:** Растущий интерес к цифровым активам
- **Капитализация:** Общий рост сектора на 25%

### 🌱 Зеленые технологии
- **Инвестиции:** $127 млрд в 2025 году
- **Солнечная энергетика:** Рекордная эффективность
- **Поддержка:** Активные правительственные программы

## 📈 Хронологический анализ
1. **Q1 2025:** Запуск новых ИИ платформ
2. **Q2 2025:** Стабилизация крипторынка
3. **Q3 2025:** Прорыв в зеленой энергетике

## 🔍 Важные цифры и статистика
- Капитализация технологического сектора: $500B (+25%)
- Количество активных инноваций: 40+ проектов
- География распространения: 45+ стран
- Уровень внедрения ИИ: 85% крупных компаний

## 🎯 Заключение
Технологический сектор демонстрирует исключительную устойчивость и потенциал для долгосрочного роста. Ключевые факторы успеха включают продолжающиеся инновации, поддержку регуляторов и растущий потребительский спрос.

**Значимость для отрасли:** Критически важные изменения, которые определят развитие на следующие 2-3 года.

*Подготовлено: {time.strftime('%Y-%m-%d %H:%M:%S')}*
*Источников проанализировано: 3*
*Уровень детализации: Высокий*"""
        }

        return summaries.get(length, summaries["medium"])

    def _generate_mock_aggregation(self, prompt: str) -> str:
        """Генерация mock агрегации"""
        return f"""# 📊 АГРЕГАЦИЯ И АНАЛИЗ ДАННЫХ

## 📈 КОЛИЧЕСТВЕННАЯ АГРЕГАЦИЯ

### Распределение по источникам:
```
📰 TechNews.com     : 15 статей (50%)
💰 CryptoDaily      : 8 статей  (27%)
🌱 GreenTech.org    : 7 статей  (23%)
```

### Временное распределение:
| Дата | Количество | Активность |
|------|------------|------------|
| 25.09 | 12 статей | 🔥🔥🔥 |
| 24.09 | 8 статей  | 🔥🔥 |
| 23.09 | 10 статей | 🔥🔥🔥 |

## ⏰ ВРЕМЕННОЙ АНАЛИЗ

### Пиковые периоды активности:
- **Утро (9-12):** 40% публикаций
- **День (12-18):** 35% публикаций
- **Вечер (18-22):** 25% публикаций

### Тренды по дням недели:
```
Пн ████████ 25%
Вт ██████   20%
Ср ██████   20%
Чт ████████ 25%
Пт ███      10%
```

## 🔍 СРАВНИТЕЛЬНЫЙ АНАЛИЗ

### Топ источников по релевантности:
1. **TechNews** - Средняя оценка: 0.92
2. **GreenTech** - Средняя оценка: 0.89
3. **CryptoDaily** - Средняя оценка: 0.85

### Аномалии и выбросы:
- Необычно высокая активность 25.09
- Пик упоминаний "ИИ" (+150%)
- Рост интереса к зеленым технологиям (+80%)

## 📊 ВИЗУАЛИЗАЦИЯ РЕЗУЛЬТАТОВ

### График распределения тем:
```
ИИ/ML        ████████████████ 40%
Криптовалюты ████████████     30%
Зеленая энерг. ████████       20%
Другое       ████             10%
```

### Карта активности:
- 🟢 Высокая активность: Технологии, Инвестиции
- 🟡 Средняя активность: Энергетика, Блокчейн
- 🔴 Низкая активность: Прочие темы

*Агрегация завершена: {time.strftime('%Y-%m-%d %H:%M:%S')}*
*Обработано элементов: 30*"""

    def _generate_mock_filtering(self, prompt: str) -> str:
        """Генерация mock фильтрации"""
        return f"""# 🔍 РЕЗУЛЬТАТЫ УМНОЙ ФИЛЬТРАЦИИ

## 📋 ОТФИЛЬТРОВАННЫЕ РЕЗУЛЬТАТЫ

### Статистика фильтрации:
- **Исходное количество:** 30 статей
- **После фильтрации:** 8 статей (27%)
- **Точность соответствия:** 95%

### Найденные статьи:
```
✅ "ИИ прорыв в технологиях" - 98% соответствие
✅ "Криптовалютный анализ" - 95% соответствие
✅ "Зеленые инвестиции" - 92% соответствие
✅ "Технологический рост" - 89% соответствие
```

## 🎯 АНАЛИЗ ОТФИЛЬТРОВАННЫХ ДАННЫХ

### Качественные характеристики:
- **Релевантность:** Высокая (средняя оценка 0.94)
- **Актуальность:** Свежие материалы (< 24 часов)
- **Разнообразие источников:** 3 независимых издания

### Ключевые темы в отобранных статьях:
1. **Искусственный интеллект** - 40%
2. **Финансовые технологии** - 35%
3. **Устойчивое развитие** - 25%

### Уникальные инсайты из подборки:
- Конвергенция ИИ и блокчейн технологий
- Рост ESG-инвестиций в tech-сектор
- Новые модели монетизации данных

## 🔧 РЕКОМЕНДАЦИИ ПО ФИЛЬТРАЦИИ

### Дополнительные полезные фильтры:
- **По авторам:** Экспертные материалы
- **По тональности:** Аналитические статьи
- **По глубине:** Детальные исследования

### Улучшения критериев:
- Добавить фильтр по типу контента
- Учитывать социальные сигналы
- Интегрировать семантический поиск

### Альтернативные подходы:
- ML-алгоритмы классификации
- Гибридная фильтрация
- Персонализированные критерии

*Фильтрация выполнена: {time.strftime('%Y-%m-%d %H:%M:%S')}*
*Эффективность: 95%*"""

    def _generate_mock_insights(self, prompt: str) -> str:
        """Генерация mock инсайтов"""
        return f"""# 💡 БИЗНЕС-ИНСАЙТЫ И РЫНОЧНАЯ АНАЛИТИКА

## 📊 РЫНОЧНАЯ АНАЛИТИКА

### Скрытые тренды:
- **Конвергенция технологий:** ИИ + Блокчейн + IoT создают новые бизнес-модели
- **Shift to sustainability:** 78% компаний внедряют ESG-критерии в стратегию
- **Данные как актив:** Монетизация данных выросла на 340%

### Изменения в конкурентной среде:
```
🔺 Растущие сегменты:
  • ИИ-as-a-Service (+65%)
  • Green fintech (+120%)
  • Quantum computing (+45%)

🔻 Снижающиеся сегменты:
  • Legacy IT systems (-23%)
  • Traditional banking (-15%)
```

## 🔮 ПРОГНОСТИЧЕСКАЯ АНАЛИТИКА

### Краткосрочные прогнозы (1-3 месяца):
1. **Консолидация ИИ-стартапов** - ожидается 15-20 M&A сделок
2. **Регулирование криптовалют** - новые законодательные инициативы
3. **Рост корпоративных инвестиций** в зеленые технологии (+35%)

### Долгосрочные перспективы (6-12 месяцев):
- **Массовое внедрение GPT-5** в корпоративном сегменте
- **Квантовое превосходство** в финансовых расчетах
- **Углеродная нейтральность** как конкурентное преимущество

### Факторы риска:
⚠️ **Высокие риски:**
- Регулятивное давление на ИИ
- Кибербезопасность в IoT
- Геополитические ограничения

⚡ **Катализаторы роста:**
- Государственные инвестиции в R&D
- Снижение стоимости вычислений
- Растущий потребительский спрос

## 💼 СТРАТЕГИЧЕСКИЕ РЕКОМЕНДАЦИИ

### Инвестиционные возможности:
```
🟢 BUY: ИИ-платформы, Green tech, Quantum computing
🟡 HOLD: Криптовалюты, Traditional tech
🔴 AVOID: Legacy systems, Non-ESG assets
```

### Рекомендации по позиционированию:
1. **First-mover advantage** в квантовых технологиях
2. **Partnership strategy** с ИИ-стартапами
3. **ESG integration** во все продуктовые линейки

### Операционные выводы:
- Инвестировать в переподготовку кадров (AI/ML skills)
- Создать центры компетенций по устойчивому развитию
- Развивать экосистемы партнерств

## 📈 ИНДИКАТОРЫ ЭФФЕКТИВНОСТИ

### KPI для отслеживания:
- **AI Adoption Rate:** Целевое значение 85% к концу года
- **Carbon Footprint:** Снижение на 25% annually
- **Innovation Index:** Рост R&D расходов на 40%

### Бенчмарки отрасли:
| Метрика | Лидеры | Средний рынок | Отстающие |
|---------|---------|---------------|-----------|
| AI внедрение | 90%+ | 60-70% | <40% |
| ESG score | 8.5+ | 6.0-7.5 | <5.0 |
| ROI инноваций | 25%+ | 15-20% | <10% |

### Сигналы раннего предупреждения:
🚨 **Критические:**
- Падение инвестиций в R&D
- Регулятивные ограничения
- Кибератаки на инфраструктуру

📊 **Мониторинг:**
- Патентная активность конкурентов
- Изменения в потребительских предпочтениях
- Макроэкономические индикаторы

*Executive briefing подготовлен: {time.strftime('%Y-%m-%d %H:%M:%S')}*
*Уровень достоверности: 92%*
*Источников: 30+ аналитических материалов*"""

    def _generate_mock_sentiment(self, prompt: str) -> str:
        """Генерация mock анализа тональности"""
        return f"""# 😊 КОМПЛЕКСНЫЙ АНАЛИЗ ТОНАЛЬНОСТИ

## 📊 ОБЩАЯ ОЦЕНКА ТОНАЛЬНОСТИ

### Итоговый Sentiment Score: **+67** (из -100 до +100)
- **Доверительный интервал:** ±8 баллов
- **Степень уверенности:** 89%

```
Шкала настроений:
[-100] ██████████████████[+67]████ [+100]
      Негативно    Нейтрально    Позитивно
```

## 📈 РАСПРЕДЕЛЕНИЕ ТОНАЛЬНОСТИ

### Детальная разбивка:
```
😊 Позитивные: 45% (обоснование: рост инвестиций, технологические прорывы)
😐 Нейтральные: 35% (обоснование: аналитические материалы, статистика)
😟 Негативные: 15% (обоснование: опасения по регулированию, риски)
🤔 Смешанные: 5% (обоснование: противоречивые сигналы рынка)
```

### Визуальное распределение:
```
Позитивные   ████████████████████ 45%
Нейтральные  ████████████████     35%
Негативные   ██████               15%
Смешанные    ██                   5%
```

## 🎯 ФАКТОРЫ ТОНАЛЬНОСТИ

### 🌟 Ключевые позитивные факторы:
1. **Технологические прорывы** - GPT-5 показывает 40% улучшение
2. **Инвестиционный рост** - $127B в зеленые технологии
3. **Институциональная поддержка** - крупные корпорации внедряют ИИ
4. **Регуляторная ясность** - четкие правила для криптовалют

### ⚠️ Основные негативные аспекты:
1. **Волатильность рынка** - цены криптовалют нестабильны
2. **Технологические риски** - вопросы безопасности ИИ
3. **Конкурентное давление** - усиление борьбы за рынки
4. **Регулятивные ограничения** - возможные новые запреты

### 🤝 Нейтральные/смешанные сигналы:
- Неопределенность в долгосрочных прогнозах
- Балансирование между инновациями и безопасностью
- Различные мнения экспертов о темпах роста

## ⏰ ДИНАМИКА НАСТРОЕНИЙ

### Изменения во времени:
```
Сент 2025: [+67] ↗️ +12 пунктов за месяц
Авг 2025:  [+55] ↗️ +8 пунктов
Июль 2025: [+47] → стабильно
```

### Триггеры изменений:
- **Позитивные события:** Анонс GPT-5, рекордные инвестиции
- **Негативные события:** Технические сбои, регулятивные риски
- **Нейтральные факторы:** Плановые обновления, рутинная отчетность

## 📊 ВЛИЯНИЕ НА РЫНОК

### Воздействие на восприятие:
- **Потребители:** 78% положительно относятся к новым технологиям
- **Инвесторы:** 65% готовы увеличить инвестиции в сектор
- **Компании:** 82% планируют цифровую трансформацию

### Влияние на решения инвесторов:
```
🟢 Покупки: 45% решений основаны на позитивных новостях
🟡 Ожидание: 35% инвесторов в режиме наблюдения
🔴 Продажи: 20% решений из-за негативных факторов
```

### Прогноз изменений тональности:
- **Следующий месяц:** Рост до +72 (оптимистичный сценарий)
- **Кварталa:** Стабилизация в диапазоне +60...+75
- **Риски снижения:** Регулятивные изменения, технические проблемы

## 🎪 ЭМОЦИОНАЛЬНЫЕ ИНДИКАТОРЫ

### Преобладающие эмоции:
- 🚀 **Энтузиазм** (25%) - технологические достижения
- 💼 **Осторожный оптимизм** (30%) - устойчивый рост
- 🤔 **Любопытство** (20%) - новые возможности
- ⚠️ **Обеспокоенность** (15%) - потенциальные риски
- 😐 **Нейтралитет** (10%) - выжидательная позиция

*Анализ тональности завершен: {time.strftime('%Y-%m-%d %H:%M:%S')}*
*Проанализировано источников: 30*
*Методология: Гибридный анализ (NLP + экспертная оценка)*"""

    def _generate_mock_topics(self, prompt: str) -> str:
        """Генерация mock моделирования тем"""
        return f"""# 🏷️ МОДЕЛИРОВАНИЕ ТЕМ И АНАЛИЗ ТРЕНДОВ

## 📋 ВЫЯВЛЕНИЕ ОСНОВНЫХ ТЕМ

### Топ-7 ключевых тем:

#### 1. 🤖 **Искусственный интеллект и машинное обучение**
- **Вес темы:** 28% (высокий приоритет)
- **Ключевые слова:** GPT-5, нейросети, автоматизация, ML-алгоритмы
- **Примеры статей:** "GPT-5 революционизирует анализ данных"

#### 2. 💰 **Финансовые технологии и криптовалюты**
- **Вес темы:** 22% (высокий приоритет)
- **Ключевые слова:** Bitcoin, блокчейн, DeFi, цифровые активы
- **Примеры статей:** "Стабилизация криптовалютного рынка"

#### 3. 🌱 **Зеленые технологии и устойчивость**
- **Вес темы:** 18% (средний приоритет)
- **Ключевые слова:** солнечная энергия, ESG, углеродная нейтральность
- **Примеры статей:** "Рекордные инвестиции в зеленую энергетику"

#### 4. 💼 **Цифровая трансформация бизнеса**
- **Вес темы:** 15% (средний приоритет)
- **Ключевые слова:** автоматизация, облачные технологии, процессы
- **Примеры статей:** "Компании ускоряют цифровизацию"

#### 5. 🔬 **Квантовые вычисления**
- **Вес темы:** 8% (растущий приоритет)
- **Ключевые слова:** кубиты, квантовое превосходство, алгоритмы
- **Примеры статей:** "Прорыв в квантовой обработке данных"

#### 6. 🛡️ **Кибербезопасность и приватность**
- **Вес темы:** 6% (стабильный приоритет)
- **Ключевые слова:** защита данных, шифрование, кибератаки
- **Примеры статей:** "Новые угрозы в эпоху ИИ"

#### 7. 🏭 **Промышленная автоматизация**
- **Вес темы:** 3% (низкий приоритет)
- **Ключевые слова:** роботизация, Industry 4.0, IoT
- **Примеры статей:** "Умные фабрики будущего"

## 📈 АНАЛИЗ ТРЕНДОВ

### 🔥 Растущие темы (emerging topics):
```
🚀 Квантовые технологии    ████████████████ 65% рост
🚀 ИИ в здравоохранении   ████████████     45% рост
🚀 Устойчивая энергетика  ██████████       40% рост
🚀 Web3 и метавселенная   ████████         35% рост
```

### 📉 Угасающие темы (declining topics):
```
📉 Legacy IT системы      ████             -25% снижение
📉 Традиционные медиа     ██               -18% снижение
📉 Fossil fuel tech       █                -12% снижение
```

### 🔄 Стабильные/устойчивые темы:
- **Кибербезопасность:** Стабильная актуальность
- **Облачные технологии:** Зрелая стабильность
- **Мобильные технологии:** Устоявшийся рынок

### ⏰ Временная эволюция:
| Период | Доминирующие темы |
|--------|-------------------|
| Q1 2025 | ИИ, Криптовалюты |
| Q2 2025 | Зеленые tech, ИИ |
| Q3 2025 | Квантовые, ИИ, ESG |

## 🕸️ ВЗАИМОСВЯЗИ ТЕМ

### Кластеризация тем:
```
🏆 КЛАСТЕР А: Передовые технологии
├── ИИ/ML
├── Квантовые вычисления
└── Автоматизация

💰 КЛАСТЕР Б: Финансовые инновации
├── Криптовалюты
├── FinTech
└── Цифровые платежи

🌍 КЛАСТЕР В: Устойчивое развитие
├── Зеленые технологии
├── ESG инвестиции
└── Циркулярная экономика
```

### Связи между темами:
- **ИИ ↔ Зеленые технологии:** Оптимизация энергопотребления
- **Блокчейн ↔ Устойчивость:** Трекинг углеродного следа
- **Квантовые ↔ Кибербезопасность:** Квантовая криптография

### Иерархия тем:
```
🏢 Мегатренд: Цифровая трансформация
  ├── 🤖 Тема: Искусственный интеллект
  │   ├── Подтема: Генеративный ИИ
  │   └── Подтема: ИИ в бизнесе
  ├── 💰 Тема: Финансовые технологии
  │   ├── Подтема: Криптовалюты
  │   └── Подтема: Цифровые платежи
  └── 🌱 Тема: Зеленые технологии
      ├── Подтема: Возобновляемая энергия
      └── Подтема: ESG инвестиции
```

## 🔮 ПРОГНОЗНАЯ АНАЛИТИКА

### Наиболее перспективные темы:
1. **🥇 ИИ + Автоматизация** - будет доминировать следующие 2 года
2. **🥈 Квантовые технологии** - критическая масса к 2026
3. **🥉 Зеленая энергетика** - обязательный тренд для всех отраслей

### Влияние на рынок и индустрию:
- **Трансформация рынка труда:** +40% спрос на ИИ-специалистов
- **Новые бизнес-модели:** Сервисы на основе данных и ИИ
- **Регулятивные изменения:** Ужесточение норм для ИИ и криптовалют

### Прогноз появления новых тем:
- **Биотехнологии + ИИ:** Персонализированная медицина
- **Космические технологии:** Коммерциализация космоса
- **Нейроинтерфейсы:** Прямая связь мозг-компьютер

## 💡 РЕКОМЕНДАЦИИ ПО ФОКУСИРОВКЕ

### Приоритетные области для мониторинга:
1. **Немедленно:** ИИ-интеграция, ESG-трансформация
2. **3-6 месяцев:** Квантовые технологии, Web3
3. **6-12 месяцев:** Биотех, нейроинтерфейсы

### Стратегические инвестиции:
- **High ROI:** ИИ-платформы, зеленые технологии
- **Medium ROI:** Квантовые стартапы, блокчейн-решения
- **Long-term ROI:** Биотех, космические технологии

*Моделирование тем завершено: {time.strftime('%Y-%m-%d %H:%M:%S')}*
*Обработано статей: 30*
*Выявлено тематических кластеров: 3*
*Уровень детализации: Глубокий*"""

    def generate_text_sync(self, prompt: str, **kwargs) -> str:
        """Синхронная генерация текста"""
        # Имитация времени обработки
        time.sleep(random.uniform(0.1, 0.3))

        # Определяем тип анализа по промпту и kwargs
        if "глубокий" in prompt.lower() and "анализ" in prompt.lower():
            return self._generate_mock_analysis(prompt)
        elif "сводка" in prompt.lower() or "summary" in prompt.lower() or kwargs.get('length'):
            length = kwargs.get('length', 'medium')
            return self._generate_mock_summary(prompt, length)
        elif "агрегация" in prompt.lower() or "aggregation" in prompt.lower():
            return self._generate_mock_aggregation(prompt)
        elif "фильтрация" in prompt.lower() or "filter" in prompt.lower():
            return self._generate_mock_filtering(prompt)
        elif "инсайты" in prompt.lower() or "insights" in prompt.lower():
            return self._generate_mock_insights(prompt)
        elif "тональность" in prompt.lower() or "sentiment" in prompt.lower():
            return self._generate_mock_sentiment(prompt)
        elif "темы" in prompt.lower() or "topics" in prompt.lower() or "моделирование тем" in prompt.lower():
            return self._generate_mock_topics(prompt)
        else:
            return f"Mock GPT-5 Response для запроса: {prompt[:50]}..."

    async def generate_text(self, prompt: str, **kwargs) -> str:
        """Асинхронная генерация текста"""
        return await asyncio.to_thread(self.generate_text_sync, prompt, **kwargs)

    def send_analysis(self, message: str, **kwargs) -> str:
        """Отправка запроса на анализ"""
        logger.info(f"📊 Mock analysis request: {len(message)} chars")
        if "моделирование тем" in message.lower() or "темы" in message.lower():
            return self._generate_mock_topics(message)
        return self._generate_mock_analysis(message)

    def send_chat(self, message: str, **kwargs) -> str:
        """Отправка chat запроса"""
        logger.info(f"💬 Mock chat request: {len(message)} chars")
        if kwargs.get('length') or "сводка" in message.lower():
            return self._generate_mock_summary(message, kwargs.get('length', 'medium'))
        elif "фильтрация" in message.lower():
            return self._generate_mock_filtering(message)
        return self.generate_text_sync(message, **kwargs)

    def send_insights(self, message: str, **kwargs) -> str:
        """Отправка запроса на инсайты"""
        logger.info(f"💡 Mock insights request: {len(message)} chars")
        return self._generate_mock_insights(message)

    def send_sentiment(self, message: str, **kwargs) -> str:
        """Отправка запроса на анализ тональности"""
        logger.info(f"😊 Mock sentiment request: {len(message)} chars")
        return self._generate_mock_sentiment(message)

    def send_bulk(self, message: str, **kwargs) -> str:
        """Отправка bulk запроса"""
        logger.info(f"📦 Mock bulk request: {len(message)} chars")
        return self._generate_mock_aggregation(message)


def create_mock_gpt5_service(preferred_model_id: Optional[str] = None) -> MockGPT5Service:
    """Создание mock GPT-5 сервиса"""
    logger.info("🧪 Creating Mock GPT-5 service for testing")
    return MockGPT5Service(preferred_model_id)


# Функция для переключения на mock режим
def enable_mock_mode():
    """Включение mock режима для тестирования"""
    import sys
    current_module = sys.modules[__name__]

    # Заменяем импорты в data_analysis_processor
    try:
        import data_analysis_processor
        data_analysis_processor.create_gpt5_service = create_mock_gpt5_service
        data_analysis_processor.GPT5Service = MockGPT5Service
        logger.info("✅ Mock mode enabled for data_analysis_processor")
    except ImportError:
        logger.warning("⚠️ Could not enable mock mode - data_analysis_processor not found")


if __name__ == "__main__":
    # Демонстрация mock сервиса
    mock_service = create_mock_gpt5_service()

    test_prompts = [
        "Проведи глубокий анализ технологических трендов",
        "Создай краткую сводку по рынку",
        "Выполни агрегацию данных по источникам",
        "Отфильтруй статьи по критерию",
        "Сгенерируй бизнес-инсайты",
        "Проанализируй тональность новостей",
        "Выяви основные темы и тренды"
    ]

    for prompt in test_prompts:
        result = mock_service.generate_text_sync(prompt)
        print(f"\n📝 Промпт: {prompt}")
        print(f"📄 Результат: {result[:100]}...")
        print("-" * 80)