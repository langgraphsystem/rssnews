# üß™ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∏ –∏–º–ø–æ—Ä—Ç–æ–≤
```bash
# –ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (–±–µ–∑ –ë–î)
python test_migration.py
```

–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–æ–≤ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ PgClient (–æ—à–∏–±–∫–∞ –±–µ–∑ PG_DSN - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- ‚úÖ –†–∞–±–æ—Ç—É –∫–æ–º–∞–Ω–¥ main.py --help
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ —É—Ç–∏–ª–∏—Ç—ã

## –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å PostgreSQL

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Railway PostgreSQL

–ü–æ–ª—É—á–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ Railway –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# Windows (cmd)
set PG_DSN=postgresql://postgres:password@hostname.railway.app:5432/railway?sslmode=require

# Windows (PowerShell)
$env:PG_DSN = "postgresql://postgres:password@hostname.railway.app:5432/railway?sslmode=require"

# Linux/Mac
export PG_DSN="postgresql://postgres:password@hostname.railway.app:5432/railway?sslmode=require"
```

### 3. –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
```bash
python test_with_real_db.py
```

–≠—Ç–æ—Ç —Ç–µ—Å—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
- üîß –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
- üîß –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î (`python main.py ensure`)
- üì° –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö RSS (`python main.py discovery`)
- üì∞ –û–ø—Ä–æ—Å RSS —Ñ–∏–¥–æ–≤ (`python main.py poll`)
- ‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç–∫—É —Å—Ç–∞—Ç–µ–π (`python main.py work`)

## –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 4. –ü–æ—à–∞–≥–æ–≤—ã–π —Ç–µ—Å—Ç –∫–æ–º–∞–Ω–¥

```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î
python main.py ensure
# –û–∂–∏–¥–∞–µ—Ç—Å—è: "OK: worksheets ensured"

# 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ RSS —Ñ–∏–¥–∞
python main.py discovery --feed "https://feeds.bbci.co.uk/news/rss.xml"
# –û–∂–∏–¥–∞–µ—Ç—Å—è: "OK: discovery finished"

# 3. –û–ø—Ä–æ—Å RSS (–Ω–∞–π—Ç–∏ –Ω–æ–≤—ã–µ —Å—Ç–∞—Ç—å–∏)
python main.py poll
# –û–∂–∏–¥–∞–µ—Ç—Å—è: "OK: poll finished"

# 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç–µ–π
python main.py work --worker-id "test-worker"
# –û–∂–∏–¥–∞–µ—Ç—Å—è: "OK: work finished"
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ PostgreSQL –∫–ª–∏–µ–Ω—Ç—É:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
\dt

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∏–¥—ã
SELECT feed_url_canon, status, checked_at FROM feeds;

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—å–∏
SELECT article_url_canon, status, title FROM raw LIMIT 10;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
SELECT * FROM config;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
SELECT ts, level, component, message FROM diagnostics ORDER BY ts DESC LIMIT 10;
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

**1. ModuleNotFoundError: No module named 'psycopg2'**
```bash
pip install psycopg2-binary
```

**2. ValueError: PG_DSN environment variable is required**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è PG_DSN
set PG_DSN=postgresql://...
```

**3. psycopg2.OperationalError: connection failed**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π—Ä–≤–æ–ª–∞

**4. permission denied for table**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ:

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|--------|-----------|
| `pg_client.py` | ‚úÖ –ù–û–í–´–ô | –ó–∞–º–µ–Ω–∞ `sheets_client.py` |
| `main.py` | ‚úÖ –û–ë–ù–û–í–õ–ï–ù | `SheetClient` ‚Üí `PgClient` |
| `discovery.py` | ‚úÖ –û–ë–ù–û–í–õ–ï–ù | –ò–º–ø–æ—Ä—Ç –∏ —Ç–∏–ø—ã |
| `poller.py` | ‚úÖ –ü–ï–†–ï–ü–ò–°–ê–ù | –†–∞–±–æ—Ç–∞ —Å –ë–î –≤–º–µ—Å—Ç–æ –ª–∏—Å—Ç–æ–≤ |
| `worker.py` | ‚úÖ –ü–ï–†–ï–ü–ò–°–ê–ù | –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ SQL |
| `schema.py` | ‚úÖ –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ |
| `config.py` | ‚úÖ –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô | –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã |
| `utils.py` | ‚úÖ –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô | –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç |

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:

- üöÄ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ü—Ä—è–º—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –≤–º–µ—Å—Ç–æ API
- üîí **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ù–µ—Ç –ª–∏–º–∏—Ç–æ–≤ API –∏ —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π  
- üìà **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: PostgreSQL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã
- üîç **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–ª–æ–∂–Ω—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤
- üí∞ **–°—Ç–æ–∏–º–æ—Å—Ç—å**: –ù–µ—Ç –∫–≤–æ—Ç Google Sheets API

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. –°–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ production –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é PG_DSN
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é: `python main.py ensure`
4. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ poll –∏ work
6. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `diagnostics` –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `python test_migration.py` –¥–ª—è –±–∞–∑–æ–≤–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è PG_DSN
3. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ PostgreSQL –ë–î
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `diagnostics`